#!/bin/sh

# Tanya SSID
echo -n "Nama WiFi (SSID): "
read ap_ssid
if [ -z "$ap_ssid" ]; then
    echo "❌ SSID tak boleh kosong!"
    exit 1
fi

# Tanya Password
echo -n "Password (Enter kalau nak open): "
read ap_key

# Set encryption ikut ada password atau tak
if [ -z "$ap_key" ]; then
    encryption="none"
else
    encryption="psk2"
fi

# ===================== Wireless 5GHz ============================================
uci set wireless.radio0=wifi-device
uci set wireless.radio0.type='mac80211'
uci set wireless.radio0.path='platform/soc@0/c000000.wifi'
uci set wireless.radio0.band='5g'
uci set wireless.radio0.channel='100'
uci set wireless.radio0.htmode='HE160'
uci set wireless.radio0.disabled='0'
uci set wireless.radio0.country='US'

uci set wireless.default_radio0=wifi-iface
uci set wireless.default_radio0.device='radio0'
uci set wireless.default_radio0.network='lan'
uci set wireless.default_radio0.mode='ap'
uci set wireless.default_radio0.ssid="$ap_ssid-5Ghz"
uci set wireless.default_radio0.encryption="$encryption"
[ "$encryption" != "none" ] && uci set wireless.default_radio0.key="$ap_key"

# ===================== Wireless 2.4GHz ============================================
uci set wireless.radio1=wifi-device
uci set wireless.radio1.type='mac80211'
uci set wireless.radio1.path='platform/soc@0/c000000.wifi+1'
uci set wireless.radio1.band='2g'
uci set wireless.radio1.channel='1'
uci set wireless.radio1.htmode='HE20'
uci set wireless.radio1.disabled='0'
uci set wireless.radio1.country='US'

uci set wireless.default_radio1=wifi-iface
uci set wireless.default_radio1.device='radio1'
uci set wireless.default_radio1.network='lan'
uci set wireless.default_radio1.mode='ap'
uci set wireless.default_radio1.ssid="$ap_ssid-2.4Ghz"
uci set wireless.default_radio1.encryption="$encryption"
[ "$encryption" != "none" ] && uci set wireless.default_radio1.key="$ap_key"

uci commit wireless
wifi reload

echo "✅ Dah set WiFi: ${ap_ssid}-2G & ${ap_ssid}-5G"
[ "$encryption" = "none" ] && echo "⚠️  WiFi OPEN (takde password!)"
